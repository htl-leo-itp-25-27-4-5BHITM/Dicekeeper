<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>One-Pager Slider mit Endlos-Loop</title>
    <style>
        :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--text:#e6eef6}
        *{box-sizing:border-box}
        body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#071226 0%, #07192b 100%);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}

        .app{width:100%;max-width:980px}
        .slider-wrap{position:relative;background:rgba(255,255,255,0.03);padding:12px;border-radius:12px;overflow:hidden}
        .slider{display:flex;gap:12px;scroll-behavior:smooth;overflow-x:auto;scrollbar-width:none}
        .slider::-webkit-scrollbar{display:none}

        .thumb{flex:0 0 180px;border-radius:8px;overflow:hidden;cursor:pointer;border:2px solid transparent}
        .thumb img{width:100%;height:120px;object-fit:cover;display:block}
        .thumb .label{padding:6px 8px;font-size:14px;background:rgba(0,0,0,0.25)}
        .thumb:focus{outline:3px solid rgba(6,182,212,0.25)}

        .nav-btn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,0.45);border:0;color:var(--text);width:44px;height:44px;border-radius:8px;backdrop-filter:blur(4px);cursor:pointer;z-index:10}
        .nav-btn:hover{background:rgba(0,0,0,0.6)}
        .nav-left{left:8px}
        .nav-right{right:8px}

        .detail{display:none;background:var(--card);padding:18px;border-radius:12px;margin-top:12px}
        .detail.active{display:block}
        .detail .back{display:inline-block;margin-bottom:12px;padding:8px 12px;border-radius:8px;background:white;cursor:pointer;color:#000}
        .detail .hero{display:flex;gap:12px;align-items:flex-start}
        .detail .hero img{width:320px;max-width:40%;height:220px;object-fit:cover;border-radius:8px}
        .detail .meta{flex:1}

        @media (max-width:700px){
            .thumb{flex:0 0 140px}
            .thumb img{height:96px}
            .detail .hero{flex-direction:column}
            .detail .hero img{width:100%;max-width:100%;height:200px}
        }
    </style>
</head>
<body>
<div class="app">
    <section class="slider-wrap" aria-label="Bild-Slider">
        <button class="nav-btn nav-left" id="prevBtn" aria-label="Vorheriges">‚óÄ</button>
        <div class="slider" id="slider"></div>
        <button class="nav-btn nav-right" id="nextBtn" aria-label="N√§chstes">‚ñ∂</button>
    </section>

    <section class="detail" id="detail">
        <button class="back" id="backBtn">‚Üê Zur√ºck zur Galerie</button>
        <div class="hero">
            <img id="detailImg" src="" alt="">
            <div class="meta">
                <h2 id="detailTitle"></h2>
                <p id="detailText"></p>
                <p style="margin-top:8px"><strong>Bildnummer:</strong> <span id="detailIndex"></span> / 13</p>
            </div>
        </div>
    </section>
</div>

<script>
    async function loadClasses() {
        try {
            const res = await fetch('/api/classes');  // üëà updated path
            if (!res.ok) throw new Error('API error ' + res.status);
            const items = await res.json();
            buildSlider(items);
        } catch (err) {
            console.error('Failed to load classes:', err);
            const slider = document.getElementById('slider');
            slider.innerHTML = '<p style="padding:1em">Fehler beim Laden der Daten.</p>';
        }
    }

    function buildSlider(items) {
        const slider = document.getElementById('slider');
        const detail = document.getElementById('detail');
        const detailImg = document.getElementById('detailImg');
        const detailTitle = document.getElementById('detailTitle');
        const detailText = document.getElementById('detailText');
        const detailIndex = document.getElementById('detailIndex');
        const backBtn = document.getElementById('backBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');

        slider.innerHTML = '';

        function createThumb(it) {
            const t = document.createElement('button');
            t.className = 'thumb';
            t.setAttribute('data-id', it.id);
            const thumbSrc = `images/photo${it.id}_thumb.jpg`;
            t.innerHTML = `<img src="../images/${it.name}.png" alt="${it.name}"><div class="label">${it.name}</div>`;
            t.addEventListener('click', () => location.hash = `photo-${it.id}`);
            return t;
        }

        items.forEach(it => slider.appendChild(createThumb(it)));
        items.forEach(it => slider.appendChild(createThumb(it)));

        function checkLoop() {
            const scrollLeft = slider.scrollLeft;
            const maxScroll = slider.scrollWidth / 2;
            if (scrollLeft >= maxScroll) slider.scrollLeft -= maxScroll;
            if (scrollLeft === 0) slider.scrollLeft += maxScroll;
        }

        function scrollByStep(dir) {
            const step = 192;
            slider.scrollBy({ left: dir * step, behavior: 'smooth' });
            setTimeout(checkLoop, 600);
        }

        prevBtn.addEventListener('click', () => scrollByStep(-1));
        nextBtn.addEventListener('click', () => scrollByStep(1));
        slider.addEventListener('scroll', checkLoop);

        function showDetail(id) {
            const it = items.find(x => x.id === id);
            if (!it) return;
            const fullImg = `../images/${it.name}.png`;
            detailImg.src = fullImg;
            detailTitle.textContent = it.name;
            detailText.textContent = it.description || '';
            detailIndex.textContent = it.id;
            detail.classList.add('active');
        }

        function hideDetail() {
            detail.classList.remove('active');
            history.replaceState(null, '', location.pathname);
        }

        window.addEventListener('hashchange', () => {
            const h = location.hash.match(/^#photo-(\d{1,3})$/);
            if (h) showDetail(Number(h[1]));
            else hideDetail();
        });

        backBtn.addEventListener('click', hideDetail);
    }

    // üëá load from /api/classes
    loadClasses();
</script>

</body>
</html>
